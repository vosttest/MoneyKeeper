<div *ngIf="loader" class="spinner">
    <div class="rect1"></div>
    <div class="rect2"></div>
    <div class="rect3"></div>
    <div class="rect4"></div>
    <div class="rect5"></div>
</div>
<section class="format-layout">
    <div class="row">
        <div class="col-md-2"></div>
        <div class="col-md-8">
            <div id="overview">
                <div class="row">
                    <div class="col-md-4"></div>
                    <div class="col-md-4">
                        <h2 class="text-center">Categories</h2>
                    </div>
                    <div class="col-md-4">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4"></div>
                    <div class="text-center col-md-4 input-group mb-3 nav">
                        <a id="tabExpense" class="form-control" (click)="loadExpense()" data-toggle="pill" href="#expense">Expense</a>
                        <a id="tabIncome" class="form-control format-input" (click)="loadIncome()" data-toggle="pill" href="#expense">Income</a>
                    </div>
                    <div class="col-md-4"></div>
                </div>
                <div class="row">
                    <div class="card bg-white card-2 full-width">
                        <div class="card-body">
                            <div class="col-md-12">
                                <input *ngIf="isShow" class="form-control margin-bottom" id="myInput" type="text" placeholder="Search by name" [(ngModel)]="keyword" (keyup)="search(keyword)">
                                <div id="expense" class="tab-pane">
                                    <div class="accordion" id="accordionExample">
                                        <div *ngFor="let i of lstParentTmp" class="card">
                                            <div class="card-header row row-margin pointer" id="headingOne">
                                                <div class="col-md-11" (click)="redirectEdit(i.id, i.count)">
                                                    <img src="{{apiURL + i.icon}}" class="image" style="margin-right: 2% ">
                                                    <span>{{ i.text }}</span>
                                                </div>
                                                <div class="col-md-1 format-iconUp" data-toggle="collapse" (click)="changeIcon(i.id)" attr.data-target="#collapseOne{{i.id}}" aria-expanded="true" aria-controls="collapseOne">
                                                    <i *ngIf="i.count!=0" id="arrow{{i.id}}" class="pull-right fa fa-chevron-up"></i>
                                                </div>
                                            </div>
                                            <div attr.id="collapseOne{{i.id}}" class="panel-collapse collapse">
                                                <ul *ngFor='let i2 of lstChildTmp' class="list-group pointer">
                                                    <li *ngIf="i2.parentId === i.id" class="list-group-item padding-left" (click)="redirectEdit(i2.id, i2.count)">
                                                        <img src="{{apiURL + i2.icon}}" class="padding-right image" /> {{i2.text}}
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-2"></div>
    </div>
    <div id="create" style="display: none">
        <div class="row">
            <div class="col-md-2">
            </div>
            <div class="col-md-8">
                <h2 class="text-center">Add {{tab}} Category </h2>
            </div>
            <div class="col-md-2">
            </div>
        </div>
        <div class="card bg-white card-2 full-width">
            <div class="card-body">
                <form #f="ngForm" (ngSubmit)="saveCategory(f.form.valid)">
                    <div class="row">
                        <div class="form-group form-control col-md-2 text-center pointer">
                            <img [src]="apiURL + vm.icon" name="icon" (click)="iconModal.show()" />
                        </div>
                        <div class="form-group col-md-5">
                            <p>Sub-Category Name</p>
                            <input class="form-control none-border" name="subCategoryName" placeholder="Sub-Category Name" #subCategoryName="ngModel" [(ngModel)]="vm.text" required/>
                            <span [hidden]="subCategoryName.valid || (subCategoryName.pristine && !f.submitted)" class="k-widget k-tooltip k-tooltip-validation k-invalid-msg field-validation-error">
                    <span *ngIf="subCategoryName.errors?.required">
                        <i class="fa fa-exclamation-triangle"></i>Required!
                    </span>
                            </span>
                        </div>
                        <div class="form-group col-md-5">
                            <p>Category</p>
                            <select id="inputState" class="form-control none-border" name="categoryName" #categoryName="ngModel" [(ngModel)]="vm.parentId">
                             <option *ngFor="let i of lstParentTmp" value="{{i.id}}">{{i.text}}</option>
                             </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <p>Note</p>
                        <textarea name="description" #description="ngModel" [(ngModel)]="vm.description" class=" form-control " rows="2 "></textarea>
                    </div>
                    <div class="text-right">
                        <button type="submit" class="btn btn-success">Save</button>
                        <button type="button" class="btn btn-secondary" routerLink="/category/overview">Cancel</button>
                    </div>
                </form>
            </div>
        </div>

    </div>
    <div id="edit" style="display: none">
        <div class="row">
            <div class="col-md-2">
            </div>
            <div class="col-md-8">
                <h2 class="text-center">Edit {{tab}} Category </h2>
            </div>
            <div class="col-md-2">
            </div>
        </div>
        <div class="card bg-white card-2 full-width">
            <div class="card-body">
                <form #f1="ngForm" (ngSubmit)="saveCategory(f.form.valid)">
                    <div class="row">
                        <div class="form-group form-control col-md-2 text-center pointer">
                            <img [src]="apiURL + vm.icon" name="icon" (click)="iconModal.show()" />
                        </div>
                        <div class="form-group col-md-5" *ngIf="count == 0">
                            <p>Sub Category Name</p>
                            <input class="form-control" name="subCategoryName" placeholder="Sub-Category Name" #subCategoryName="ngModel" [(ngModel)]="vm.text" required/>
                            <span [hidden]="subCategoryName.valid || (subCategoryName.pristine && !f.submitted)" class="k-widget k-tooltip k-tooltip-validation k-invalid-msg field-validation-error">
                                <span *ngIf="subCategoryName.errors?.required">
                                    <i class="fa fa-exclamation-triangle"></i>Required!
                                </span>
                            </span>
                        </div>
                        <div class="form-group col-md-5" *ngIf="count == 0">
                            <p>Parent Category</p>
                            <select id="inputState" class="form-control none-border" name="categoryName" #categoryName="ngModel" [(ngModel)]="vm.parentId">
                                <option value="0" >
                                    No item selected
                                </option>
                                <option *ngFor="let i of lstParentTmp" value="{{i.id}}"  [selected]="selEdit">{{i.text}}</option>
                            </select>
                        </div>
                        <div class="col-md-10" *ngIf="count != 0">
                            <p>Sub Category Name</p>
                            <input class="form-control" name="subCategoryName" placeholder="Sub-Category Name" #subCategoryName="ngModel" [(ngModel)]="vm.text" required/>
                            <span [hidden]="subCategoryName.valid || (subCategoryName.pristine && !f.submitted)" class="k-widget k-tooltip k-tooltip-validation k-invalid-msg field-validation-error">
                    <span *ngIf="subCategoryName.errors?.required">
                        <i class="fa fa-exclamation-triangle"></i>Required!
                    </span>
                            </span>
                        </div>
                    </div>
                    <div class="form-group">
                        <p>Note</p>
                        <textarea name="description" #description="ngModel" [(ngModel)]="vm.description" class=" form-control " rows="2 "></textarea>
                    </div>
                    <div class="text-right">
                        <button type="submit" class="btn btn-success">Save</button>
                        <button type="button" class="btn btn-danger" (click)="confirmModal.show()">Delete</button>
                        <button type="button" class="btn btn-secondary" routerLink="/category/overview">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div bsModal #confirmModal="bs-modal" class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Confirm</h5>
                </div>
                <div class="modal-body">
                    Are you sure delete this Category ?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" (click)="delete(vm.id)">Yes</button>
                    <button type="button" class="btn btn-success" (click)="confirmModal.hide()">No</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div bsModal #confirmModal1="bs-modal" class="modal fade" id="confirmModal1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Notification</h5>
                </div>
                <div class="modal-body">
                    Save successfully!
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" (click)="confirmModal1.hide()">OK</button>
                </div>
            </div>
        </div>
    </div>

    <!--Icon Modal -->
    <div bsModal #iconModal="bs-modal" class="modal fade" id="iconModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabe2" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header bg-info text-light">
                    <h5 class="modal-title" id="exampleModalLabel">Icon</h5>
                    <button type="button" class="close" (click)="iconModal.hide()" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
                </div>
                <div class="modal-body list-icon ">
                    <div class="btn-group" role="group" aria-label="Basic example">
                        <button type="button" *ngFor='let i of lstImages' class="btn btn-light">
                        <img src="{{apiURL + i.text}}" (click)="selectIcon(i.text)"/>
                    </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<div bsModal #informationModal="bs-modal" [config]="{backdrop: 'static'}" class="modal fade" id="informationModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Information</h5>
            </div>
            <div class="modal-body">
                {{ msg }}
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-success" (click)="informationModal.hide()" routerLink="/category/overview">OK</button>
            </div>
        </div>
    </div>
</div>