<section class="format-layout">
    <div id="editVoucher">
        <div class="row">
            <div class="col-md-4">
            </div>
            <div class="col-md-4">
                <h2 class="text-center">Edit Voucher</h2>
            </div>
            <div class="col-md-4">
            </div>
        </div>
        <div class="card bg-white card-2 full-width">
            <div class="card-body">
                <form class="voucher" name="form" #f="ngForm" (ngSubmit)="f.form.valid && save()">
                    <div class="row">
                        <div class="form-group col-md-6">
                            <p>Type</p>
                            <select name="type" #type="ngModel" [(ngModel)]="vm.type" class="form-control" (click)="hideShow(vm.type)">
                                    <option value='Expense' selected>Expense</option>
                                    <option value='Income'>Income</option>
                                    <option value='Adjustment'>Adjustment</option>
                                </select>
                        </div>
                        <div class="form-group col-md 6">
                            <p>Amount</p>
                            <input type='number' name="total" id="total" #total="ngModel" [(ngModel)]="vm.total" class='form-control' placeholder='0' required>
                            <span [hidden]="total.valid || (total.pristine && !f.submitted)" class="k-widget k-tooltip k-tooltip-validation k-invalid-msg field-validation-error">
                                        <i class="fa fa-exclamation-triangle"></i> Required!
                                    </span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group col-md-6">
                            <p>Category <span class="text-danger">*</span></p>
                            <div class="col-md-6" (click)='categoryModal.show()'>
                                <img *ngIf='selectedCategory.icon != ""' width="40px" src="{{apiURL + selectedCategory.icon}}" /> {{ selectedCategory.text }}
                            </div>
                            <span [hidden]="selectedCategory.code != '' || (selectedCategory.code === '' && !f.submitted)" class="k-widget k-tooltip k-tooltip-validation k-invalid-msg field-validation-error">
                                            <i class="fa fa-exclamation-triangle"></i> Required!
                                        </span>
                            <hr/>
                        </div>
                        <div class="form-group col-md-6" (click)='accountModal.show()'>
                            <p>{{ labelAccountId }} <span class="text-danger">*</span></p>
                            <div class="col-md-6">{{ selectedAccount.text }}
                            </div>
                            <span [hidden]="selectedAccount.accountId != 0 || (selectedAccount.accountId === 0 && !f.submitted)" class="k-widget k-tooltip k-tooltip-validation k-invalid-msg field-validation-error">
                                        <i class="fa fa-exclamation-triangle"></i> Required!
                                </span>
                            <hr/>
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group col-md-6" *ngIf="isTransfer">
                            <p>Transfer fee</p>
                            <div class="row">
                                <div class='input-group mb-3'>
                                    <input type='number' name="transferFee" id="transferFee" #transferFee="ngModel" [(ngModel)]="vm.transferFee" class='form-control' placeholder='0'>
                                </div>
                            </div>
                        </div>
                        <div class="form-group col-md-6" *ngIf="isTransfer" (click)='toAccountModal.show()'>
                            <p>To Account <span class="text-danger">*</span></p>
                            <div class="col-md-6">{{ selectedToAccount.text }}
                            </div>
                            <span [hidden]="selectedToAccount.accountId != 0 || (selectedToAccount.accountId === 0 && !f.submitted)" class="k-widget k-tooltip k-tooltip-validation k-invalid-msg field-validation-error">
                                             <i class="fa fa-exclamation-triangle"></i> Required!
                                        </span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group col-md 6" *ngIf="isExpense || isTransfer">
                            <p>Payee</p>
                            <input class="form-control none-border" name="Payee" #payee="ngModel" [(ngModel)]="vm.payee" />
                        </div>
                        <div class="form-group col-md 6" *ngIf="isTransfer || isIncome">
                            <p>Payer</p>
                            <input class="form-control none-border" name="Payer" #payer="ngModel" [(ngModel)]="vm.payer" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group col-md-12">
                            <p>Date</p>
                        </div>
                    </div>
                    <div class="form-group">
                        <p>Note</p>
                        <textarea name="description" #description="ngModel" [(ngModel)]="vm.description" class=" form-control " rows="2 "></textarea>
                    </div>
                    <button type="submit" class="btn btn-success">Save</button>
                    <button type="button" class="btn btn-danger" (click)="confirmModalDelete.show()">Delete</button>
                    <button type="button" class="btn btn-secondary" routerLink="/voucher/overview">Cancel</button>
                </form>
            </div>
        </div>
    </div>
</section>

<!-- Modal -->
<div bsModal #categoryModal='bs-modal' class='modal fade' tabindex='-1' role='dialog' aria-labelledby='myModalLabel' aria-hidden='true'>
    <div class='modal-dialog modal-lg' role='document'>
        <div class='modal-content'>
            <div class='modal-header'>
                Choose Category
                <button type='button' class='text-right' (click)='categoryModal.hide()' aria-label='Close'>
                            <i class='fa fa-window-close'></i>
                        </button>
            </div>
            <div class='modal-body height-modal'>
                <input #keyword='ngModel' ngModel type='text' class='form-control' placeholder='Search..' (keyup)='search(keyword.value)'>
                <div *ngFor="let i of lstParentTmp" class="card">
                    <div class="card-header row row-margin pointer" id="headingOne">
                        <div class="col-md-11" (click)="chooseCategory(i.code, i.text, i.icon)">
                            <img src="{{apiURL + i.icon}}" style="margin-right: 2%">
                            <span>{{ i.text }}</span>
                        </div>
                        <div class="col-md-1 format-iconUp" data-toggle="collapse" (click)="changeIcon(i.id)" attr.data-target="#collapseOne{{i.id}}" aria-expanded="true" aria-controls="collapseOne">
                            <i id="arrow{{i.id}}" class="pull-right fa fa-chevron-up"></i>
                        </div>
                    </div>
                    <div attr.id="collapseOne{{i.id}}" class="panel-collapse collapse">
                        <ul *ngFor='let i2 of lstChildTmp' class="list-group pointer">
                            <li *ngIf="i2.parentId === i.id" class="list-group-item padding-left" (click)="chooseCategory(i2.code, i2.text, i2.icon)">
                                <img src="{{apiURL + i2.icon}}" class="padding-right" /> {{i2.text}}
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class='modal-footer'></div>
        </div>
    </div>
</div>

<!-- Modal -->
<div bsModal #accountModal='bs-modal' class='modal fade' tabindex='-1' role='dialog' aria-labelledby='myModalLabel' aria-hidden='true'>
    <div class='modal-dialog modal-lg' role='document'>
        <div class='modal-content'>
            <div class='modal-header'>
                Choose Account
                <button type='button' class='text-right' (click)='accountModal.hide()' aria-label='Close'>
                            <i class='fa fa-window-close'></i>
                        </button>
            </div>
            <div class='modal-body height-modal'>
                <input #keyword='ngModel' ngModel type='text' class='form-control' placeholder='Search..' (keyup)='search(keyword.value)'>
                <div *ngFor="let i of account" class="card">
                    <div class="card-header row row-margin pointer" id="headingOne">
                        <div class="col-md-11" (click)="chooseAccount(i.id, i.text)">
                            <span>
                                    <div class="left"> {{ i.text }}</div>
                                    <div class="right"> Balance: {{ i.balance }} Vnd</div>
                                </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div bsModal #toAccountModal='bs-modal' class='modal fade' tabindex='-1' role='dialog' aria-labelledby='myModalLabel' aria-hidden='true'>
    <div class='modal-dialog modal-lg' role='document'>
        <div class='modal-content'>
            <div class='modal-header'>
                Choose To Account
                <button type='button' class='text-right' (click)='toAccountModal.hide()' aria-label='Close'>
                                <i class='fa fa-window-close'></i>
                            </button>
            </div>
            <div class='modal-body height-modal'>
                <input #keyword='ngModel' ngModel type='text' class='form-control' placeholder='Search..' (keyup)='search(keyword.value)'>
                <div *ngFor="let i of account" class="card">
                    <div class="card-header row row-margin pointer" id="headingOne">
                        <div class="col-md-11" (click)="chooseToAccount(i.id, i.text)">
                            <span>
                                        <div class="left"> {{ i.text }}</div>
                                        <div class="right"> Balance: {{ i.balance }} Vnd</div>
                                    </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div bsModal #confirmModalDelete="bs-modal" class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Confirm</h5>
            </div>
            <div class="modal-body">
                Are you sure delete this Account ?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" (click)="delete()">Yes</button>
                <button type="button" class="btn btn-success" (click)="confirmModal.hide()">No</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div bsModal #confirmModal="bs-modal" class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Information</h5>
            </div>
            <div class="modal-body">
                Save successfully!
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-success" (click)="confirmModal.hide()" routerLink="/voucher/overview">OK</button>
            </div>
        </div>
    </div>
</div>